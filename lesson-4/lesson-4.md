# Урок 4. Парсинг HTML. XPath

7 типов узлов:
* элемент
* атрибут
* текст
* пространство имен
* комментарии
* узлы документа

Навигация по дом `document.childNodes[0].childNodes[2].value`.
`XPath` - язык запросов к элементам XML-документа.
Автор говорит о широком множестве применения.
`*` - любой потомок в родителе.
[пример](xpath_example.png)
`xpath` - всегда обходит все элементы.
за что `xpath` можно любить? за специальное расширение `chromepath` - лучше работает в хроме.
стили, вычисления, ...`chromexpath`.
`chromexpath` - не используйте абсолютный, а на относительный поглядывайте, если он короткий.

`/` - ищем среди детей, и мы так задолбаемся описывать всех детей
`//` - на всех уровнях вложенности~~~~
[chromexpath](chromexpath.png)
`//ol//li//a//span//span`
Старайтесь писать читаемые и легко модифицируемые, поскольку в оптимизации не выигрываете.

## Уточняющие моменты для `xpath`

### Позиция

`//ol[1]` - нумерация начинается с 1.
`//ol[last()]` - last element
`position() >= 3` третий и больше
`position() < 2 or position() > 3`
`not(position()) < 2)`

### Атрибуты

Самый простой и быстрый способ работы.
`[@class]` - означает атрибут `class`
`[@class='weather_temp']` - строгое совпадение значения.
`/div[contains(@class, 'weather_icon')'` - вхождение значения в атрибут класс. Спасает от автоматически генерируемых значений, поскольку в них мы можем зацепиться за константу в сгенерированном значении.
`/div[contains(@class, 'weather_icon')' or @class='sss']` - пишем через or.

!составляйте выражения не глубже 3х

## пример

`pip install lxml`

```python
from xml import html
import requests
from pprint import pprint

header = {'user-agent': '...'} # используйте, чтобы ответ был одинаковым там где вы смотрели, и здесь в коде
response = requests.get()
dom = html.fromstring(response.text)
names = dom.xpath('//h3[@class="s-item__title"]')
# names - в отладчике плохо просматривается.
names = dom.xpath('//h3[@class="s-item__title"]/text')

prices = dom.xpath('//h3[@class="s-item__price"]/text')
# ребенок моего ребенка не мой ребенок.
# здесь где-то в родителе, где-то в дочернем элементе - решается пост обработкой, главное чтобы все данные собрали.


# наверх идем через '..' две точки.
links = dom.xpath("//h3[@class='s-item__title']/../@href")

```

1:54

Но что если собрали всего 4 из 30, то кому принадлежат эти 4?
```python
lights = []

items = dom.xpath()

for item in items:
    name = item.xpath('//h3')
```

Но подход выше не работает, поскольку оне не использует item, как отправную точку.
Лечится довольно просто - точкой './/h3'

## ДЗ

на выбор 3 задания

лента ру

источников публикации нет. поэтому фиксировано пишем лента ру
на базовой странице собираем ссылки на новости
Дату публикации можно собрать из href
Далее переходим на новость по ссылке и с нее собираем 

news.mail.ru
5 фоток и 6 новостей - снаружи нет данных,
поэтому заходим в новость и там собираем.

yandex.ru/news
самый сложный
все данные есть на поверхности,
можно так же выбирать часть.

## проверка дз

```python
# уникальная вставка
# крутой способ, поскольку, никто не шел на вакансию, тогда подняли по ней зарплату, и вы это изменение зарплаты в других случаях уникальости не отразате.
authors.update_one({'author': 'Peter2'}, {'$set': new_data}, insert=True)
```

